#!/usr/bin/env sh

PKG_PATH="$R_PACKAGE_DIR"

if ["$TORCH_CONFIG_INSTALL" == "1"]; then
  echo "Installing torch deps"
  if test -z TORCH_HOME; then
    TORCH_HOME=$PKG_PATH
  fi
  "${R_HOME}/bin/Rscript" -e "source('$PKG_PATH/R/install.R'); install_torch()"
fi

if ! test -z $DEVTOOLS_LOAD; then
  PKG_PATH="$(pwd)/inst"
fi

if test -z "$CMAKE_FLAGS"; then
  CMAKE_FLAGS=""
fi

if [ "$BUILD_LANTERN" != true ] && [ "$BUILD_LANTERN" != 1 ]; then
  BUILD_LANTERN=""
fi

if [ "$BUILD_LANTERN" != "" ]; then
  LANTERN_TARGET="lantern"
  echo "CMAKE_FLAGS: $CMAKE_FLAGS"
else
  LANTERN_TARGET="dummylantern"
fi

cd src
sed -e "s|@LANTERN_TARGET@|$LANTERN_TARGET|" -e "s|@PKG_PATH@|$PKG_PATH|" -e "s|@CMAKE_FLAGS@|$CMAKE_FLAGS|"  Makevars.in > Makevars
